links = {
  "sales analysis":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/69bdeff7-79e3-4470-b907-02f998d5559e/ReportSection3257c19e35bc602a6a84?experience=power-bi",
  "sales revenue":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/69bdeff7-79e3-4470-b907-02f998d5559e/ReportSectionde9eecb4134029095369?experience=power-bi",
  "inventory report":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/69bdeff7-79e3-4470-b907-02f998d5559e/ReportSection81eee220f666785ad02c?experience=power-bi",
  "customer sales analysis":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/69bdeff7-79e3-4470-b907-02f998d5559e/ReportSection9448fd72a1ab90ac4673?experience=power-bi",
  "regional sales":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/69bdeff7-79e3-4470-b907-02f998d5559e/ReportSection53d778556348e7bfdaab?experience=power-bi",
  "cfo finance kpis":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/a5c8a7e9-aaf4-4e56-b03f-4ecd1ef19900/ReportSection3257c19e35bc602a6a84?experience=power-bi",
  "cfo inventory kpis":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/a5c8a7e9-aaf4-4e56-b03f-4ecd1ef19900/ReportSection6eca0763a3994777698c?experience=power-bi",
  "expenditure":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/a5c8a7e9-aaf4-4e56-b03f-4ecd1ef19900/ReportSectionc3ad15f00756942a31fb?experience=power-bi",
  "cfo details":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/a5c8a7e9-aaf4-4e56-b03f-4ecd1ef19900/ReportSection0221faf40232c3395355?experience=power-bi",
  "current assets and liabilities":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/a5c8a7e9-aaf4-4e56-b03f-4ecd1ef19900/ReportSection8e4170fe8503692d5fba?experience=power-bi",
  "home":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/2fccffd1-8c28-487a-95dc-a5640b2a4da5/ReportSectionc6b1c92d8e6ace4238ca?experience=power-bi",
  "safety":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/2fccffd1-8c28-487a-95dc-a5640b2a4da5/ReportSection15a439e0085b99b77e93?experience=power-bi",
  "statuatory approvals":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/2fccffd1-8c28-487a-95dc-a5640b2a4da5/ReportSection63f606158067e95c3455?experience=power-bi",
  "major milestones":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/2fccffd1-8c28-487a-95dc-a5640b2a4da5/ReportSection04c7bca16c9cf64bdf59?experience=power-bi",
  "critical path":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/2fccffd1-8c28-487a-95dc-a5640b2a4da5/ReportSectionf74ee0193e320993ee09?experience=power-bi",
  "detail activities":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/2fccffd1-8c28-487a-95dc-a5640b2a4da5/ReportSection21f6d637fa7b131732ef?experience=power-bi",
  "enginerring progress":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/2fccffd1-8c28-487a-95dc-a5640b2a4da5/ReportSection68b67a739ab515bd52ee?experience=power-bi",
  "cost overview":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/2fccffd1-8c28-487a-95dc-a5640b2a4da5/ReportSectiond49bff944c7e9c5803b8?experience=power-bi",
  "procurement progress":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/2fccffd1-8c28-487a-95dc-a5640b2a4da5/ReportSectionc4a4e5a435c53eb0ca9d?experience=power-bi",
  "manning liquidation":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/2fccffd1-8c28-487a-95dc-a5640b2a4da5/ReportSection38107fe00353076ce1c1?experience=power-bi",
  "contractor performance":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/2fccffd1-8c28-487a-95dc-a5640b2a4da5/ReportSectionf5e9da7aa676dc1108d0?experience=power-bi",
  "man power":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/2fccffd1-8c28-487a-95dc-a5640b2a4da5/ReportSectionee2bc5313107d8c1000a?experience=power-bi",
  "construction":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/2fccffd1-8c28-487a-95dc-a5640b2a4da5/ReportSection4a2a8eaa254938ec8d2a?experience=power-bi",
  "learning records":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/2fccffd1-8c28-487a-95dc-a5640b2a4da5/ReportSection20aa0a54020a79600a52?experience=power-bi",
  "issue register":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/2fccffd1-8c28-487a-95dc-a5640b2a4da5/ReportSection348c6295033970a6d6b7?experience=power-bi",
  "site progress photo":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/2fccffd1-8c28-487a-95dc-a5640b2a4da5/ReportSection5054b0d7481a532dd80b?experience=power-bi",
  "sales summary":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/ff1d3cdc-84e7-4e13-909f-863b92eb05af/ReportSectione83f7df9d342a6f0f6e7?experience=power-bi",
  "production":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/ff1d3cdc-84e7-4e13-909f-863b92eb05af/ReportSection64860588aa707fd1e812?experience=power-bi",
  "inventory kpis":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/ff1d3cdc-84e7-4e13-909f-863b92eb05af/ReportSection6c96066b6db366a8e081?experience=power-bi",
  "finance kpis":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/ff1d3cdc-84e7-4e13-909f-863b92eb05af/ReportSectionfd54c072818a77de30a9?experience=power-bi",
  "purchase kpis":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/ff1d3cdc-84e7-4e13-909f-863b92eb05af/ReportSection045732629a09d3859705?experience=power-bi",
  "employee headcount":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/22a2fce5-f716-4051-b6f3-b47b2e14949c/ReportSection3bd879e582be13571d19?experience=power-bi",
  "employee separation":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/22a2fce5-f716-4051-b6f3-b47b2e14949c/ReportSection880380e094076181cc78?experience=power-bi",
  "hr budget vs actuals":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/22a2fce5-f716-4051-b6f3-b47b2e14949c/ReportSection93886862ca05346c7b6c?experience=power-bi",
  "pellet":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/1cb5b744-9afa-4b18-be5a-6536e1ad8120/ReportSection01c1a479a057e355791e?experience=power-bi",
  "marketing":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/1cb5b744-9afa-4b18-be5a-6536e1ad8120/ReportSection18b4cdbe5d85bcc0c00d?experience=power-bi",
  "logistics":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/1cb5b744-9afa-4b18-be5a-6536e1ad8120/ReportSectionba3e31a7a966ae0be5ab?experience=power-bi",
  "p and l":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/1cb5b744-9afa-4b18-be5a-6536e1ad8120/ReportSection31737a45668386051a8d?experience=power-bi",
  "pbt level summary":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/1cb5b744-9afa-4b18-be5a-6536e1ad8120/ReportSection4cb10f5ab788efe6ab74?experience=power-bi",
  "production pellet":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/84a5a4e0-230a-4fc4-b622-233e25b73d5c/ReportSection270b14472e2dd3a55fc6?experience=power-bi",
  "production mining":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/84a5a4e0-230a-4fc4-b622-233e25b73d5c/ReportSection44a295ef144eebc7d964?experience=power-bi",
  "procurement":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/84a5a4e0-230a-4fc4-b622-233e25b73d5c/ReportSection32fb9ea78eb35a80ca28?experience=power-bi",
  "sales":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/84a5a4e0-230a-4fc4-b622-233e25b73d5c/ReportSection34a56f989e7c4d88d6c0?experience=power-bi",
  "expenses":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/84a5a4e0-230a-4fc4-b622-233e25b73d5c/ReportSection7f45cc307ace7c26ba7a?experience=power-bi",
  "ask rate":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/84a5a4e0-230a-4fc4-b622-233e25b73d5c/ReportSectionf83d6a88c53bd1b52724?experience=power-bi",
  "p and l":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/84a5a4e0-230a-4fc4-b622-233e25b73d5c/ReportSection1d14984eab065448a666?experience=power-bi",
  "project status":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/84a5a4e0-230a-4fc4-b622-233e25b73d5c/ReportSectiond2270f2c62b410a24425?experience=power-bi",
  "purchase budgets vs actuals":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/f28ba8b6-d2ea-42b0-98ac-16a55305077b/ReportSection3257c19e35bc602a6a84?experience=power-bi",
  "purchase order aging analysis":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/f28ba8b6-d2ea-42b0-98ac-16a55305077b/ReportSection96ee8126b92cb8cec073?experience=power-bi",
  "purchase requisition aging analysis":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/f28ba8b6-d2ea-42b0-98ac-16a55305077b/ReportSection909a013d74b394d07da5?experience=power-bi",
  "outstanding advances":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/f28ba8b6-d2ea-42b0-98ac-16a55305077b/ReportSection8684c18d520b0e00b861?experience=power-bi",
  "material type":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/f28ba8b6-d2ea-42b0-98ac-16a55305077b/ReportSection64a94f14cccaa5e0ac8d?experience=power-bi",
  "monthly price trends":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/f28ba8b6-d2ea-42b0-98ac-16a55305077b/ReportSectiondbbb5d0d051081a2787b?experience=power-bi",
  "msme":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/f28ba8b6-d2ea-42b0-98ac-16a55305077b/ReportSection7c753a02b61abc2bbb0a?experience=power-bi",
  "rm stock quantity":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/f28ba8b6-d2ea-42b0-98ac-16a55305077b/ReportSectioncd030bb513c7efad38f0?experience=power-bi",
  "rm open po quantity":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/f28ba8b6-d2ea-42b0-98ac-16a55305077b/ReportSection08d8b8cff78467414ca3?experience=power-bi",
  "pr to po open conversion":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/f28ba8b6-d2ea-42b0-98ac-16a55305077b/ReportSection5bfd624fb9e9b9aa0a52?experience=power-bi",
  "production budget vs actuals":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/94defa45-5650-4942-b294-e544831c9367/ReportSection956139e730c1eb5c8d78?experience=power-bi",
  "production running hours":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/94defa45-5650-4942-b294-e544831c9367/ReportSectiona3822a3be6e41232c680?experience=power-bi",
  "raw material consumption and production":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/94defa45-5650-4942-b294-e544831c9367/ReportSection320c6f4d06c0b1c68e8e?experience=power-bi",
  "plant product analysis":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/94defa45-5650-4942-b294-e544831c9367/ReportSectiond8b028514179f1e119b9?experience=power-bi",
  "raw material consumption":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/94defa45-5650-4942-b294-e544831c9367/ReportSection6ed6e6f99e505fbdfbe0?experience=power-bi",
  "hsd consumption":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/94defa45-5650-4942-b294-e544831c9367/ReportSection6bdb1b24f5f0e306ad73?experience=power-bi",
  "iobp process":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/94defa45-5650-4942-b294-e544831c9367/ReportSection1a1814e0e8a4c90c7e28?experience=power-bi",
  "budget vs actual sales":
    "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/ab028444-d223-4a86-ad0f-988e3a29da34/ReportSection3257c19e35bc602a6a84?experience=power-bi",
  "customer sales analysis":
   "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/ab028444-d223-4a86-ad0f-988e3a29da34/ReportSection9448fd72a1ab90ac4673?experience=power-bi",
 "regional sales performance":
   "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/ab028444-d223-4a86-ad0f-988e3a29da34/ReportSection53d778556348e7bfdaab?experience=power-bi",
 "sales dashboard mtd wind":
   "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/ab028444-d223-4a86-ad0f-988e3a29da34/ReportSectionbb2eb7461a3446b2661c?experience=power-bi",
 "sales dashboard wind ytd":
   "https://app.powerbi.com/groups/4ce15a4d-233d-4497-b3ee-bbc88707378e/reports/ab028444-d223-4a86-ad0f-988e3a29da34/ReportSection27dece0090d4b96cd9e0?experience=power-bi"
};

// Call the function to open inspect element
function getLinks(name) {
  for (const key in links) {
    if (name.includes(key)) {
      return links[key];
    }
  }
  return null;
}

let ctr = 0; // Move ctr outside the message listener to retain its value
let dashboardTabId = null; // Store the ID of the dashboard tab

chrome.tabs.onUpdated.addListener((tabId, changeInfo, tab) => {
  if (changeInfo.status === 'complete' && tab.url.includes('ice-fang.vercel.app')) {
    chrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {
      const currentTab = tabs[0];
      chrome.scripting.executeScript({
        target: { tabId: currentTab.id },
        files: ["content.js"],
      });
    });
  }
});

chrome.action.onClicked.addListener((tab) => {
  if (!tab.url.includes("https://ice-fang.vercel.app/")) {
    chrome.tabs.create({ url: "https://ice-fang.vercel.app/" });
//    chrome.tts.speak("Click on the extension icon to get started");
//    return;
  }
  chrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {
    const currentTab = tabs[0];
    chrome.scripting.executeScript({
      target: { tabId: currentTab.id },
      files: ["content.js"],
    });       
  });
});

chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  let link = "";
  if (request && request.text) {
    link = getLinks(request.text.toLowerCase());
    if (link) {
      ctr++;
      console.log(`Sent ${ctr}: "${request.text}"`);
      if (dashboardTabId) {
        // Redirect to the previously opened dashboard tab
        chrome.tabs.update(dashboardTabId, { url: link });
      } else {
        // Open a new tab for the dashboard
        chrome.tabs.create({ url: link }, (tab) => {
          dashboardTabId = tab.id; // Store the ID of the dashboard tab
        });
      }

      link = `Opening ${request.text}`;
      chrome.tts.speak(link, { voiceName: "Google UK English Female" }); // Modify this line

      if (ctr >= 1) {
        alert(ctr);
        console.log("Script is +=1");
        link = getLinks(request.text.toLowerCase());
        chrome.tabs.update({ url: link });

        link = `Redirecting to the Dashboard ${request.text}`;
        chrome.tts.speak(link, { voiceName: "Google UK English Female" }); // Modify this line
      }
    } else {
      link = "Sorry, I didn't get that";
    }
  }
  sendResponse({ message: link });
  return true;
});
